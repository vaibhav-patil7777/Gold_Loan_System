{% extends 'base.html' %}
{% block content %}
<style>
/* üåå Premium Dark Gold Glass Theme */
body {
  background: transparent;
  color: #fff3cd;
  font-family: 'Poppins', sans-serif;
}

/* üíé Main Container */
.history-container {
  width: 90%;
  max-width: 1100px;
  margin: 60px auto;
  padding: 50px 40px;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(18px);
  border-radius: 20px;
  box-shadow: 0 0 25px rgba(255, 202, 58, 0.25);
  text-align: center;
  animation: fadeIn 1s ease-in-out;
}

/* ‚ú® Glowing Title */
.page-title {
  font-size: 34px;
  font-weight: 700;
  color: #ffca3a;
  letter-spacing: 1px;
  margin-bottom: 35px;
  text-shadow: 0 0 15px rgba(255, 202, 58, 0.9);
}

/* ‚¨Ö Back Button */
.back-btn {
  background: linear-gradient(135deg, #ffca3a, #f77f00);
  border: none;
  color: #1a1a1a;
  padding: 12px 22px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s;
  float: left;
  box-shadow: 0 0 15px rgba(255, 202, 58, 0.7);
}
.back-btn:hover {
  background: linear-gradient(135deg, #ffd166, #ffca3a);
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(255, 202, 58, 1);
}

/* üîç Search Bar */
.search-bar {
  display: flex;
  justify-content: flex-end;
  margin: 30px 0 25px;
  clear: both;
}
.search-bar input {
  width: 340px;
  padding: 12px 20px;
  border-radius: 35px;
  border: none;
  background: rgba(255, 255, 255, 0.12);
  color: #fff;
  font-size: 15px;
  outline: none;
  transition: 0.3s;
}
.search-bar input::placeholder {
  color: rgba(255, 255, 255, 0.7);
}
.search-bar input:focus {
  background: rgba(255, 255, 255, 0.25);
  box-shadow: 0 0 15px rgba(255, 202, 58, 0.9);
}

/* üìã Table Styling */
.table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 0 15px rgba(255, 202, 58, 0.15);
}
.table thead th {
  background: rgba(20, 20, 19, 0.25);
  color: #ffca3a;
  font-size: 15px;
  padding: 12px;
  text-transform: uppercase;
  border-bottom: 2px solid rgba(255, 202, 58, 0.3);
}
.table tbody td {
  padding: 12px;
  color: #fff8dc;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.table tbody tr:hover {
  background: rgba(255, 202, 58, 0.1);
  transition: 0.3s;
}

/* üéØ Action Buttons */
.btn-view, .btn-loan {
  background: linear-gradient(135deg, #ffca3a, #f77f00);
  border: none;
  color: #1a1a1a;
  padding: 8px 16px;
  border-radius: 10px;
  font-size: 14px;
  text-decoration: none;
  font-weight: 600;
  transition: 0.3s;
  box-shadow: 0 0 12px rgba(255, 202, 58, 0.5);
}
.btn-view:hover, .btn-loan:hover {
  background: linear-gradient(135deg, #ffd166, #ffca3a);
  transform: scale(1.05);
  box-shadow: 0 0 18px rgba(255, 202, 58, 0.8);
}

/* üö´ No Data */
.no-data {
  color: #fff3cd;
  font-style: italic;
  padding: 20px;
  text-align: center;
}

/* ‚ú® Animation */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

/* üì± Responsive */
@media (max-width: 768px) {
  .search-bar {
    justify-content: center;
  }
  .search-bar input {
    width: 100%;
  }
  .back-btn {
    float: none;
    margin-bottom: 15px;
  }
}
</style>

<div class="history-container">
  <h2 class="page-title">üìú Customer History</h2>
  <button class="back-btn" onclick="window.location.href='{% url 'dashboard' %}'">‚¨Ö Back</button>

  <!-- üîç Search -->
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="üîé Search by any field (name, mobile, address, status)...">
  </div>

  <!-- üßæ Table -->
  <table class="table" id="customerTable">
    <thead>
      <tr>
        <th>Customer Name</th>
        <th>Mobile</th>
        <th>Address</th>
        <th>Loan Status</th>
        <th>Remaining Balance</th>
        <th>History</th>
        <th>Apply New Loan</th>
      </tr>
    </thead>
    <tbody>
      {% for customer in customers %}
      <tr>
        <td>{{ customer.name }}</td>
        <td>{{ customer.mobile }}</td>
        <td>{{ customer.address }}</td>
        <td>
          {% if customer.loan_status == "Completed" %}
            <span style="color: #00ff99; font-weight: bold;">Completed</span>
          {% elif customer.loan_status == "No Loan" %}
            <span style="color: #ccc;">‚Äì</span>
          {% else %}
            <span style="color: #ffcc00; font-weight: bold;">Active</span>
          {% endif %}
        </td>
        <td>‚Çπ{{ customer.remaining_balance }}</td>
        <td><a href="{% url 'history_detail' customer.id %}" class="btn-view">View</a></td>
        <td><a href="{% url 'add_gold' customer.id %}" class="btn-loan"> Apply</a></td>
      </tr>
      {% empty %}
      <tr><td colspan="7" class="no-data">No customers available.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <p id="noResult" class="no-data" style="display: none;">No matching customers found.</p>
</div>

<!-- üß† Live Search -->
<script>
document.getElementById('searchInput').addEventListener('keyup', function () {
  const input = this.value.trim().toLowerCase();
  const rows = document.querySelectorAll('#customerTable tbody tr');
  const noResult = document.getElementById('noResult');
  let visible = 0;

  rows.forEach(row => {
    const name = row.cells[0].textContent.toLowerCase();
    const mobile = row.cells[1].textContent.toLowerCase();
    const address = row.cells[2].textContent.toLowerCase();
    const status = row.cells[3].textContent.toLowerCase();
    const balance = row.cells[4].textContent.toLowerCase();

    // ‚úÖ Match any column: name, mobile, address, status, balance
    if (
      name.includes(input) ||
      mobile.includes(input) ||
      address.includes(input) ||
      status.includes(input) ||
      balance.includes(input)
    ) {
      row.style.display = '';
      visible++;
    } else {
      row.style.display = 'none';
    }
  });

  noResult.style.display = (visible === 0) ? 'block' : 'none';
});
</script>
{% endblock %}
